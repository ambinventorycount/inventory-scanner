<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .scanner-container { margin: 20px 0; }
        #scanner-viewport { 
            width: 100%;
            height: 300px;
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
        }
        .input-group { margin: 10px 0; }
        input, button { padding: 10px; margin: 5px; width: 80%; }
        button { background: #007bff; color: white; border: none; }
        .status { color: green; margin: 10px 0; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Scan Barcodes</h1>
    
    <div class="input-group">
        <label>Item Barcode:</label>
        <input type="text" id="itemBarcode">
        <button onclick="startScanner('itemBarcode')">Scan Item</button>
    </div>

    <div class="input-group">
        <label>Serial Barcode:</label>
        <input type="text" id="serialBarcode">
        <button onclick="startScanner('serialBarcode')">Scan Serial</button>
    </div>

    <div class="scanner-container">
        <div id="scanner-viewport"></div>
    </div>

    <button onclick="saveToSheet()">Save to Google Sheet</button>
    <div id="status" class="status"></div>

    <script>
        let currentScanField = '';
        let isScanning = false;

        function startScanner(fieldId) {
            currentScanField = fieldId;
            if (!isScanning) {
                initializeScanner();
            }
        }

        function initializeScanner() {
            isScanning = true;
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-viewport'),
                    constraints: {
                        facingMode: "environment"
                    }
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "upc_reader"]
                }
            }, (err) => {
                if (err) {
                    console.error(err);
                    showStatus(err.message, true);
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected((result) => {
                const code = result.codeResult.code;
                document.getElementById(currentScanField).value = code;
                stopScanner();
                showStatus('Barcode scanned successfully!');
            });
        }

        function stopScanner() {
            Quagga.stop();
            isScanning = false;
        }

        async function saveToSheet() {
            const item = document.getElementById('itemBarcode').value;
            const serial = document.getElementById('serialBarcode').value;
            
            if (!item || !serial) {
                showStatus('Please fill both fields', true);
                return;
            }

            const scriptURL = 'YOUR_GOOGLE_SCRIPT_URL_HERE';
            const data = {
                item: item,
                serial: serial,
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    showStatus('Data saved successfully!');
                    document.getElementById('itemBarcode').value = '';
                    document.getElementById('serialBarcode').value = '';
                } else {
                    showStatus('Error saving data', true);
                }
            } catch (error) {
                showStatus('Network error: ' + error.message, true);
            }
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'error' : 'status';
            setTimeout(() => statusDiv.textContent = '', 3000);
        }
    </script>
</body>
</html>