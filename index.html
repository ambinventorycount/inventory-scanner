<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 10px; }
        .scanner-section { position: relative; margin: 10px 0; }
        #scanner-preview { width: 100%; height: 300px; border: 2px solid #ccc; }
        .controls { margin: 10px 0; }
        button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; }
        input { width: 100%; padding: 10px; margin: 5px 0; }
        .form-section { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Scan Barcodes</h1>
    
    <!-- Scanner Section -->
    <div class="scanner-section">
        <div id="scanner-preview"></div>
        <div class="controls">
            <button onclick="toggleCamera()">Toggle Camera</button>
            <button onclick="toggleTorch()">Toggle Torch</button>
        </div>
    </div>

    <!-- Manual Input Section -->
    <div class="form-section">
        <input type="text" id="itemBarcode" placeholder="Item Barcode">
        <input type="text" id="serialBarcode" placeholder="Serial Barcode">
        <button onclick="submitData()">Submit</button>
    </div>

    <script>
        let scannerActive = false;
        let currentTorch = false;

        function initializeScanner() {
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-preview'),
                    constraints: {
                        facingMode: "environment",
                        focusMode: "continuous",
                        advanced: { torch: currentTorch }
                    }
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "upc_reader", "code_39_reader"]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    return;
                }
                Quagga.start();
                scannerActive = true;
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                if (!document.getElementById('itemBarcode').value) {
                    document.getElementById('itemBarcode').value = code;
                } else {
                    document.getElementById('serialBarcode').value = code;
                    Quagga.stop();
                    scannerActive = false;
                }
            });
        }

        function toggleCamera() {
            if (scannerActive) {
                Quagga.stop();
                scannerActive = false;
            } else {
                initializeScanner();
            }
        }

        function toggleTorch() {
            currentTorch = !currentTorch;
            if (scannerActive) {
                Quagga.stop();
                initializeScanner();
            }
        }

        function submitData() {
            const item = document.getElementById('itemBarcode').value;
            const serial = document.getElementById('serialBarcode').value;
            
            // Replace with your Google Sheets script URL
            const scriptURL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
            
            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify({
                    itemBarcode: item,
                    serialBarcode: serial,
                    timestamp: new Date().toISOString()
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => alert('Data submitted successfully!'))
            .catch(error => alert('Error submitting data!'));
        }

        // Initialize scanner on load
        initializeScanner();
    </script>
</body>
</html>